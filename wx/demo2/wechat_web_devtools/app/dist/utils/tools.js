"use strict";function init(){var e=require("url"),n=require("os"),o=require("path"),r=require("fs"),t=require("net"),i=require("../common/log/log.js"),s=require("async"),a=require("child_process").exec,c=(require("rmdir"),require("../config/dirConfig.js")),p=(nw.App,{}),l=!1,u=9973,f="darwin"===process.platform;_exports={parseURL:function(e){var n=/^http(s)?:\/\//;return n.test(e)?e:"http://"+e},getAvailablePort:function(e,n){function o(e){var n=u,r=t.createServer();r.listen(n,function(o){r.once("close",function(){u=n+1,e(null,n)}),r.close()}),r.on("error",function(r){i.info("tools.js getAvailablePort error "+n),u++,o(e)})}for(var r=[],a=0;a<n;a++)r.push(o);s.series(r,function(n,o){i.info("tools.js getAvailablePort success "+JSON.stringify(o)),e(o)})},getAppConfig:function(){var e=nw.App.getDataPath(),n=o.join(e,"..","config.json"),t={isDev:!!process.execPath.match("nw.exe")||!!process.execPath.match("nwjs.app")},s=r.existsSync(n);if(!s)return t;try{t=JSON.parse(r.readFileSync(n))}catch(a){}return i.info("tools.js getAppConfig: "+JSON.stringify(t)),t.isDev=t.isDev||!!process.execPath.match("nw.exe")||!!process.execPath.match("nwjs.app"),t.onLine=!1,t},getArgsURL:function(e){var n=Array.isArray(e);n||(e=e.split(" "));var o=e.find(function(e){return 0===e.indexOf("href://")});if(o){var r=o.replace("href://","");return this.parseURL(r)}},getSysIpInfo:function(){var e=n.networkInterfaces(),o=[];return Object.keys(e).forEach(function(n){var r=0;e[n].forEach(function(e){"IPv4"===e.family&&e.internal===!1&&(r>=1||o.push(e.address))})}),i.info("index.js getSysIpInfo: "+JSON.stringify(o)),o},openInspectWin:function(e){var n=require("path");nw.Window.open("about:blank",{show:!1,width:799,height:799,inject_js_end:n.join(__dirname,"../inject/chromeInspect.js")},function(e){e.maximize(),e.window.location="chrome://inspect/#devices",e.show(),i.info("index.js openInspectWin")})},clearProxyCache:function(){p={}},getProxyForURL:function(n){var o=e.parse(n);return n=o.protocol+"//"+o.hostname,p[n]?i.info("tools.js getProxyForURL "+n+" from proxyCache: "+p[n]):(p[n]=nw.App.getProxyForURL(n),i.info("tools.js getProxyForURL "+n+" from nw.App.getProxyForURL: "+p[n])),p[n]},getVersionNum:function(e){return e=e||nw.App.manifest.version,e=e.replace(/\./g,""),parseInt(e)},hasNewVersion:function(e){var n=e.clientConfig.last_version,o=nw.App.manifest.version;if(o===n||!n)return{};o=o.split(".");for(var r=n.split("."),t=0,i=r.length;t<i;t++){if(parseInt(r[t])>parseInt(o[t])){var s=e.urlConfig.webdebugger_download+"?from=tools&cv="+this.getVersionNum();return s+="darwin"===process.platform?"&os=darwin":"x64"===process.arch?"&os=x64":"&os=x86",{last_version:n,downloadURL:s}}if(parseInt(r[t])<parseInt(o[t]))return{}}},notifications:function(e,n,o,r){var t=(+new Date).toString();return r=r||function(){},o=o||[],l||(l={},chrome.notifications.onButtonClicked.addListener(function(e,n){l[e]&&l[e](n)})),l[t]=r,chrome.notifications.create(t,{type:"basic",iconUrl:"app/images/logo.png",title:e,message:n,buttons:o}),t},up:function(e){var n=global.appVersion=nw.App.manifest.version;if(global.appConfig.isDev)return void e();var r=localStorage.getItem("new-version"),t=this.getVersionNum(r),s=this.getVersionNum();s<t?!function(){var t=function(n,o,t){n?(l.innerHTML='<div class="app-up-data">更新失败</div>',setTimeout(function(){e()},3e3)):(l.innerHTML="",global.appVersion=r,l.innerHTML='<div class="app-up-data">更新成功，当前版本 '+r+"</div>",global.contentWindow.title="微信web开发者工具 v"+r,global.Win.title="微信web开发者工具 v"+r,setTimeout(function(){e(),nw.Shell.openExternal("https://mp.weixin.qq.com/debug/wxadoc/dev/devtools/download.html")},1e3),delete localStorage["new-version"]),delete localStorage["new-version"]};i.info("tools.js currentVersion: "+n+" newVersion: "+r+" ");var s=c.WeappApplication,p=f?o.join(s,r,"app.nw"):o.join(s,r,"package.nw"),l=global.contentDocument.querySelector("#container");if(l.innerHTML='<div class="app-up-data">更新中...</div>',f){var u=o.join(__dirname,"../../../../");a('cp -r "'+p+'" "'+u+'"',t)}else{var g=require("node-windows"),v='xcopy "'+p+'" "'+o.join(process.execPath,"..","package.nw")+'" /s /e /y /i';g.elevate(v,t)}}():e()}}}var _exports;init(),module.exports=_exports;