"use strict";function init(){var e=(require("os"),require("path")),r=(require("http"),require("../common/request/request.js")),t=require("fs"),n=require("../stores/windowStores.js"),i=require("../stores/projectStores.js"),a=require("../config/dirConfig.js"),o=(require("url"),nw.App,a.WeappFileCache),u="tmp",c="store",s="apptmpfile_",l="appforeverfile_",f="wxfile://",p=function(r){var i=void 0,a=n.getUserInfo(),c=a?a.openid:"unknow";do i=u+"_"+r+c+ +new Date;while(t.existsSync(e.join(o,i)));return i};_exports={isAppTmpPath:function(e){return e=e.replace(f,""),0===e.indexOf(u)||0===e.indexOf(c)||0===e.indexOf(s)||0===e.indexOf(l)},getRealPath:function(r){var t=r.replace(f,"");return this.isAppTmpPath(t)?e.join(o,t):r},copyFileDataToTemp:function(r,n,i){var a=p(n);return t.writeFileSync(e.join(o,""+a+i),r),""+f+a+i},copyFileToTemp:function(e,r,n){if(t.existsSync(e)){var i=t.readFileSync(e);return this.copyFileDataToTemp(i,r,n)}return!1},saveFileForever:function(e){var r=this.getRealPath(e);if(t.existsSync(r)){var n=e.replace(u,c);return t.renameSync(r,this.getRealPath(n)),n}return!1},uploadFileToServer:function(e){var n=e.url,i=e.filePath,a=e.name,o=e.header,u=e.formData;o=o||{},u=u||{},u[a]=t.createReadStream(this.getRealPath(i)),r({url:n,method:"post",needToken:-1,headers:o,formData:u},function(r,t,n){e.callback&&e.callback(r,t,n)})},downloadFileFormServer:function(e){var t=e.url,n=e.header;n=n||{},r({url:t,method:"get",encoding:null,needToken:-1,headers:n},function(r,t,n){e.callback&&e.callback(r,t,n)})},getSavedFileList:function(){var r=i.getCurrentProject(),a=r.hash,u=n.getUserInfo(),s=u?u.openid:"unknow",l=t.readdirSync(o).filter(function(e){return!!~e.indexOf(c+"_"+a+s)});return l.reduce(function(r,n){var i=t.statSync(e.join(o,n));return r.push({filePath:""+f+n,size:i.size,createTime:parseInt(i.ctime.getTime()/1e3)}),r},[])},getFileStat:function(r){var n=r.replace(f,"");n=e.join(o,n);var i=void 0;return t.existsSync(n)&&(i=t.statSync(n)),i},removeSavedFile:function(e){var r=this.getRealPath(e),n=!1;return t.existsSync(r)&&(t.unlinkSync(r),n=!0),n},saveBase64DataToFile:function(r,n){var a=i.getCurrentProject(),u=a.hash,c=new Buffer(r,"base64").toString("binary"),s=p(u);return t.writeFileSync(e.join(o,""+s+n),c,"binary"),""+f+s+n}}}var _exports;init(),module.exports=_exports;