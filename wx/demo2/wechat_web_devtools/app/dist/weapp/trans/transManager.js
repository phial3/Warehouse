"use strict";function init(){function r(r,e){r.error?e(404,{"Weapp-Error":encodeURIComponent(r.error)},r.error.toString()):e(null,{},r.data)}function e(e,j){var F=s.getProject(e),x=s.getFileNameFromUrl(e,F);x=decodeURI(x);var h=s.isWxmlFile(x),E=s.isWxssFile(x);if(E)p(e,{project:F},function(e,o){r({error:e,data:o},j)});else if(h){var R=[];R.push(function(r){var e=l.getAppJSONSync(F),o=e.pages,n=x.replace(t.extname(x),""),s=o.findIndex(function(r){return r===n});s>-1?r(null,s):r({type:q,msgForConsole:q+"app.json 中未配置，当前页面 "+n+" 请检查后重试。",msg:"app.json 中未配置当前页面 <br> "+n+" <br>请检查后重试。"})}),R.push(function(r){i(F,{url:e},function(e,o){r(e,o)})}),R.push(function(r){a(e,{project:F},function(e,o){r(e,o)})}),n.parallel(R,function(r,o){if(r){var t=v.replace(/{{error}}/,function(){return r.msg}).replace(/{{msgForConsole}}/,function(){var e=r.type,o=void 0;return e===d?o=m.parseWxmlErr(F,r.msgForConsole):e===q&&(o=r.msgForConsole),o});return void j(500,{},t)}var n={};try{n=l.getPageJSONSync(F,e)}catch(s){c.showWeappError(s.type,m.parseJsonParseErr(s))}var i={config:n,project:F,url:e,pageFrameTpl:o[1],generateFunc:o[2].generateFunc},a=u(i);j(null,a.header,a.body)})}else{var W=g.parse(e),y=W.pathname,C=t.basename(y);if(f.isAppTmpPath(C)){var P=f.getRealPath(C);o.readFile(P,function(e,o){r({error:e,data:o},j)})}else{var T=t.extname(x);s.whiteFileExtName[T]?l.getFile(F,x,function(e,o){r({error:e,data:o},j)}):r({error:"404"},j)}}}var o=require("fs"),t=require("path"),n=require("async"),s=require("../utils/tools.js"),i=(require("../../stores/projectStores.js"),require("./transConfigToPf.js")),a=require("./transWxmlToJs.js"),u=require("./transWxmlToHtml.js"),l=require("../utils/projectManager.js"),p=require("./transWxssToCss.js"),c=require("../../actions/windowActions.js"),f=require("../../utils/file.js"),g=require("url"),m=require("../utils/parseErr.js"),j=require("../../config/config.js"),d=j.WXML_ERROR,q=j.PAGE_DEFINE_ERROR,v=require("../tpl/errorTpl.js");_exports={getResponse:e}}var _exports;init(),module.exports=_exports;