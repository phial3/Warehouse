"use strict";function init(){var e=require("fs"),o=require("./pack.js"),r=require("./build.js"),i=require("path"),n=require("../../common/request/request.js"),t=require("../../config/dirConfig.js"),u=require("../../stores/projectStores.js"),s=require("../../config/urlConfig.js"),d=require("rmdir");_exports={};var p=t.Weappdest;_exports.uploadForTest=function(t,c,a){var f=u.getProjectConfig(t),l=void 0;try{l=f.Setting.MaxCodeSize}catch(v){l=1}var m=1024*l,q=!c.isBuildForUpload;r(t,{noCompile:!0},function(r,u){if(r)return void a({msg:r.toString()});var f=i.join(p,+new Date+".wx");o(u,f,function(o,r){d(u,function(e,o,r){});var i=e.lstatSync(f),p=parseInt(i.size/1024);if(p>m)return e.unlink(f,function(){}),void a({msg:"代码包大小为 "+p+" kb，超出限制 "+(p-m)+" kb，请删除文件后重试"});var l=void 0;if(q)l=s.testSourceURL+"?appid="+t.appid;else{var v=encodeURIComponent(c.desc),g=encodeURIComponent(c.version),j=encodeURIComponent(c.uuid);l=s.commitSourceURL+"?appid="+t.appid+"&user-version="+g+"&user-desc="+v+"&uuid="+j}n({url:l,method:"post",body:e.readFileSync(r),needToken:1},function(o,r,i){a(o,r,i,{MAX_APP_LENGTH:m}),e.unlink(f,function(){})})})})},_exports.upload=function(e,o,r){o.isBuildForUpload=!0,_exports.uploadForTest(e,o,r)}}var _exports;init(),module.exports=_exports;