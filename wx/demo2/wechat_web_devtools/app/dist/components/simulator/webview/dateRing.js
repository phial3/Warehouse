"use strict";function init(){var t=require("../../../lib/react.js"),e=(require("../../../lib/react-dom.js"),require("./pickerRing")),r=t.createClass({displayName:"DateRing",getInitialState:function(){for(var t=[],e=[],r=[],a=1;a<32;a++)a<13&&e.push(a>9?a+"月":"0"+a+"月"),r.push(a>9?a+"日":"0"+a+"日");for(var n=1900;n<=2100;n++)t.push(n+"年");return{yearArray:t,monthArray:e,dayArray:r,yearCurrent:(new Date).getFullYear(),monthCurrent:0,dayCurrent:1}},componentDidMount:function(){this.range={},this.setRange("start",this.props.start||"1900-01-01"),this.setRange("end",this.props.end||"2100-01-01"),this.setCurrent(this.props.current)},componentWillReceiveProps:function(t){if(t.current!=this.props.current){var e=e.split("-"),r=parseInt(e[0]),a=parseInt(e[1]),n=parseInt(e[1]);this.setState({yearCurrent:isNaN(r)?(new Date).getFullYear():Math.min(Math.max(r,0),2100),monthCurrent:isNaN(a)?0:Math.min(Math.max(a,0),11),dayCurrent:isNaN(n)?1:Math.min(Math.max(n,0),31)})}t.start!=this.props.start&&this.setRange("start",t.start||"1900-01-01"),t.end!=this.props.end&&this.setRange("end",t.end||"2100-01-01")},validDate:function(t,e,r){var a=new Date(t+"-"+(e+1)+"-"+r),n=a.getDate();return this.state.dayCurrent!=n&&(this.setState({dayCurrent:n}),this.refs.dayPicker.setCurrent(n-1)),a},setRange:function(t,e){if(e){var r=new Date(e);"Invalid Date"!=r&&(this.range[t]=r.getTime())}},setCurrent:function(t){if(t){var e=new Date(t);"Invalid Date"==e&&(e=new Date,e.getTime()<this.range.start?e=new Date(this.range.start):e.getTime()>this.range.end&&(e=new Date(this.range.end))),this.setState({yearCurrent:e.getFullYear(),monthCurrent:e.getMonth(),dayCurrent:e.getDate()})}},onYearSelect:function(t){var e=t+1900,r=this.validDate(e,this.state.monthCurrent,this.state.dayCurrent);r.getTime()<this.range.start?(e=new Date(this.range.start).getFullYear(),this.refs.yearPicker.setCurrent(e-1900)):r.getTime()>this.range.end&&(e=new Date(this.range.end).getFullYear(),this.refs.yearPicker.setCurrent(e-1900)),this.setState({yearCurrent:e})},onMonthSelect:function(t){var e=t,r=this.validDate(this.state.yearCurrent,e,this.state.dayCurrent);r.getTime()<this.range.start?(e=new Date(this.range.start).getMonth(),this.refs.monthPicker.setCurrent(e)):r.getTime()>this.range.end&&(e=new Date(this.range.end).getMonth(),this.refs.monthPicker.setCurrent(e)),this.setState({monthCurrent:e})},onDaySelect:function(t){var e=t+1,r=this.validDate(this.state.yearCurrent,this.state.monthCurrent,e);e=r.getDate(),r.getTime()<this.range.start?e=new Date(this.range.start).getDate():r.getTime()>this.range.end&&(e=new Date(this.range.end).getDate()),this.setState({dayCurrent:e}),this.refs.dayPicker.setCurrent(e-1)},getValue:function(){var t=this.state.yearCurrent;if("month"===this.props.fields){var e=this.state.monthCurrent+1;e=e>9?e:"0"+e,t=t+"-"+e}else if("day"===this.props.fields){var r=this.state.monthCurrent+1;r=r>9?r:"0"+r;var a=this.state.dayCurrent;a=a>9?a:"0"+a,t=t+"-"+r+"-"+a}return t},render:function(){return t.createElement("div",{className:"wx-picker-bd"},t.createElement(e,{ref:"yearPicker",array:this.state.yearArray,current:this.state.yearCurrent-1900,onPickerSelect:this.onYearSelect}),t.createElement(e,{ref:"monthPicker",hidden:"year"==this.props.fields,array:this.state.monthArray,current:this.state.monthCurrent,onPickerSelect:this.onMonthSelect}),t.createElement(e,{ref:"dayPicker",hidden:"day"!=this.props.fields,array:this.state.dayArray,current:this.state.dayCurrent-1,onPickerSelect:this.onDaySelect}))}});_exports=r}var _exports;init(),module.exports=_exports;